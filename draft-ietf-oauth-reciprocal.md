---
title: Reciprocal OAuth
abbrev: I-D
docname: draft-ietf-oauth-reciprocal-latest
date: 2018-05-26
category: info
ipr: trust200902

author:
 -
    ins: D. Hardt
    name: Dick Hardt
    organization: Amazon
    email: dick.hardt@gmail.com

normative:
  RFC2119:
  RFC6749:
  RFC6750:

informative:

--- abstract

There are times when a user has a pair of protected resources that would like to request access to each other. While OAuth flows typically enable the user to grant a client access to a protected resource, granting the inverse access requires an additional flow. Reciprocal OAuth enables a more seamless experience for the user to grant access to a pair of protected resources.

--- middle

# Introduction

In the usual three legged, authorization code grant, the OAuth flow enables a resource owner (user) to enable a client (party A) to be granted authorization to access a protected resource (party B). If party A also has a protected resource that the user would like to let party B access, then a complete OAuth flow, but in the reverse direction, must be performed. 


Reciprocal OAuth enables party A to obtain consent from the user to grant access to a protected resource at party A, and to short circuit the OAuth flow by passing an authorization code to party B using the access token party A obtained from party B to provide party B the context of the user. This simplifies the user experience for each party to obtain access tokens from the other.

## Terminology

In this document, the key words "MUST", "MUST NOT", "REQUIRED",
"SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
and "OPTIONAL" are to be interpreted as described in BCP 14, RFC 2119
{{RFC2119}}.

# Reciprocal Authorization Flow

The reciprocal authorization flow starts after the client (party A) has obtained an access token from the authorization server (party B) per {{RFC6749}} 4.1 Authorization Code Grant. 

## User Consent
Party A obtains consent from the user to grant access to protected resources at party A. The consent represents the scopes party B had preconfigured at party A.

## Reciprocal Authorization Code
Party A generates an authorization code representing the access granted to party B by the user. Party A then makes a request to party B's token endpoint authenticating per {{RFC6749}} 2.3 and sending the following parameters using the "application/x-www-form-urlencoded" format per {{RFC6749}} Appendix B with a character encoding of UTF-8 in the HTTP request entity-body:

   grant_type
         REQUIRED.  Value MUST be set to "urn:ietf:params:oauth:grant-type:reciprocal". 

   code
         REQUIRED.  The authorization code generated by party A.

   client_id
         REQUIRED, party A'a client ID.

   access_token
         REQUIRED, the access token obtained from Party B. Used to provide user context. 
         [DH: security concern passing the access token in the body?] 


For example, the client makes the following HTTP request using TLS
   (with extra line breaks for display purposes only):

     POST /token HTTP/1.1
     Host: server.example.com
     Authorization: Basic ej4hsyfishwssjdusisdhkjsdksusdhjkjsdjk
     Content-Type: application/x-www-form-urlencoded

     grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3reciprocal&code=hasdyubasdjahsbdkjbasd&client_id=example.com&access_token=sadadojsadlkjasdkljxxlkjdas



Party B MUST then verify the access token was granted to the client identified by the client_id.

Party B MUST respond with either an HTTP 200 (OK) response if the request is valid, or an HTTP 400 "Bad Request" if it is not.

Party B then plays the role of the client to make an access token request per {{RFC6749}} 4.1.3. 

# IANA Considerations

TBD.

# Acknowledgements

TBD.

--- back

# Document History

## draft-hardt-oauth-mutual-00

- Initial version.

## draft-hardt-oauth-mutual-01

- renamed to Reciprocal OAuth
- clarified user consent in reciprocal flow
- changed authentication to be client authentication per {{RFC6749}} 2.3

## draft-hardt-oauth-mutual-02

- changed grant type to URI
- added valid request response codes in 2.2

#NOTES FOR NEXT DRAFT

call out how party B needs to verify secret and client ID match
call out how party B needs to verify required fields are present
generally call out how this call to token endpoint is different from other calls



